package wx

import (
	"context"
	"net/http"

	"github.com/zeromicro/go-zero/core/logx"

	"chongsheng.art/wesearch/services/wxmanager/api/internal/svc"
)

const (
	wxEchoKey = "echostr"
)

type WeChatValidationWithRawHTTPLogic struct {
	logx.Logger
	ctx    context.Context
	svcCtx *svc.ServiceContext
}

func NewWeChatValidationWithRawHTTPLogic(ctx context.Context, svcCtx *svc.ServiceContext) *WeChatValidationWithRawHTTPLogic {
	return &WeChatValidationWithRawHTTPLogic{
		Logger: logx.WithContext(ctx),
		ctx:    ctx,
		svcCtx: svcCtx,
	}
}

func (l *WeChatValidationWithRawHTTPLogic) WeChatValidationWithRawHTTP(w http.ResponseWriter, r *http.Request) {
	// generated by custom templates

	// 未实现消息验证，直接返回结果
	str := r.URL.Query().Get(wxEchoKey)
	w.WriteHeader(http.StatusOK)
	w.Write([]byte(str))
	return
}
